<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Robot Eyes (FS + Wake Lock)</title>
<style>
  :root{
    --eye-gap: 8vmin;
    --eye-size: 42vmin;
    --pupil-size: 16vmin;
    --blink-speed: 180ms;
    --bg: #000;
  }
  html, body { height: 100%; margin: 0; background: var(--bg);
    touch-action: none; overscroll-behavior: contain; -webkit-tap-highlight-color: transparent; }
  @media (orientation: landscape){
    :root{
      --eye-size: calc(42vmin * 1.5);
      --pupil-size: calc(16vmin * 1.5);
      --eye-gap: calc(8vmin * 2);
    }
  }
  #fsBtn{
    position: fixed; top: calc(10px + env(safe-area-inset-top));
    right: calc(10px + env(safe-area-inset-right)); z-index: 10;
    font: 600 14px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    padding: .6rem .9rem; border-radius: 999px;
    border: 1px solid rgba(128,200,255,.6);
    background: rgba(64,160,255,.22); color:#fff;
    backdrop-filter: blur(6px); cursor: pointer;
  }
  #fsBtn.hidden{ display:none; }
  #fsBtn:active{ transform: translateY(1px); }
  .face { height: 100%; display: grid; place-items: center; }
  .eyes { display: grid; grid-auto-flow: column; align-items: center; gap: var(--eye-gap); }
  .eye { position: relative; width: var(--eye-size); height: var(--eye-size);
    border-radius: 50%; overflow: hidden;
    background: radial-gradient(ellipse at 40% 40%, #fff 0 70%, #e9e9e9 100%);
    box-shadow: 0 1.2vmin 3vmin rgba(0,0,0,.45), inset 0 -0.8vmin 1.6vmin rgba(0,0,0,.12); }
  .pupil { position: absolute; width: var(--pupil-size); height: var(--pupil-size);
    border-radius: 50%; background: radial-gradient(circle at 40% 35%, #222 0 45%, #000 70%, #000 100%);
    left: 50%; top: 50%; transform: translate(-50%, -50%); transition: transform 80ms ease; will-change: transform; }
  .shine { position:absolute; width: calc(var(--pupil-size) * .35); height: calc(var(--pupil-size) * .35);
    border-radius:50%; background: rgba(255,255,255,.85); left:25%; top:22%; filter: blur(0.2vmin); }
  .shine::after{ content:""; position:absolute; width:55%; height:55%; left:150%; top:130%;
    border-radius:50%; background: rgba(255,255,255,.4); filter: blur(0.25vmin); }
  .eyelid { position:absolute; inset:0; background: var(--bg);
    transform-origin: top center; transform: scaleY(0); pointer-events:none; }
  .blink .eyelid { animation: blink var(--blink-speed) ease-in-out forwards; }
  @keyframes blink { 0%{transform:scaleY(0)} 45%{transform:scaleY(1)} 100%{transform:scaleY(0)} }
</style>
</head>
<body>
  <button id="fsBtn">전체화면</button>

  <div class="face" id="face">
    <div class="eyes">
      <div class="eye"><div class="pupil"><div class="shine"></div></div><div class="eyelid"></div></div>
      <div class="eye"><div class="pupil"><div class="shine"></div></div><div class="eyelid"></div></div>
    </div>
  </div>

<script>
(() => {
  const root = document.documentElement;
  const fsBtn = document.getElementById('fsBtn');
  const eyes = [...document.querySelectorAll('.eye')];
  const pupils = [...document.querySelectorAll('.pupil')];

  /* 랜덤 깜빡임 */
  function scheduleBlink(){
    const t = 2200 + Math.random()*3300;
    setTimeout(() => {
      eyes.forEach(e => {
        e.classList.add('blink');
        setTimeout(() => e.classList.remove('blink'),
          parseFloat(getComputedStyle(root).getPropertyValue('--blink-speed')) + 40);
      });
      scheduleBlink();
    }, t);
  }
  scheduleBlink();

  /* 동공 이동 */
  function clampPupil(dx, dy, limit){
    const dist = Math.hypot(dx, dy);
    if (dist <= limit) return {x: dx, y: dy};
    const r = limit / dist;
    return {x: dx*r, y: dy*r};
  }
  function movePupils(nx, ny){
    eyes.forEach((eye, i) => {
      const rect = eye.getBoundingClientRect();
      const rEye = Math.min(rect.width, rect.height)/2;
      const pupil = pupils[i];
      const limit = rEye * 0.32;
      const dx = nx * limit, dy = ny * limit;
      const p = clampPupil(dx, dy, limit);
      pupil.style.transform = `translate(calc(-50% + ${p.x}px), calc(-50% + ${p.y}px))`;
    });
  }
  function handlePointer(e){
    const pt = ('touches' in e) ? e.touches[0] : e;
    const cx = window.innerWidth/2, cy = window.innerHeight/2;
    const dx = pt.clientX - cx, dy = pt.clientY - cy;
    const d = Math.hypot(window.innerWidth, window.innerHeight) || 1;
    const nx = Math.max(-1, Math.min(1, (dx / (d*0.25))));
    const ny = Math.max(-1, Math.min(1, (dy / (d*0.25))));
    movePupils(nx, ny);
  }
  window.addEventListener('pointermove', handlePointer, {passive:true});
  window.addEventListener('pointerdown', handlePointer, {passive:true});
  window.addEventListener('deviceorientation', e=>{
    const {beta, gamma} = e; if (beta==null || gamma==null) return;
    const nx = Math.max(-1, Math.min(1, gamma/30));
    const ny = Math.max(-1, Math.min(1, beta/30));
    movePupils(nx, ny);
  }, true);
  window.addEventListener('resize', ()=>movePupils(0,0));
  movePupils(0,0);

  /* ===== Screen Wake Lock (전체화면에서 화면 꺼짐 방지) ===== */
  let wakeLock = null;
  async function requestWakeLock(){
    try{
      if ('wakeLock' in navigator && !wakeLock){
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener?.('release', ()=>{ wakeLock = null; });
      }
    }catch(err){
      // 일부 기기/상황에서 거부될 수 있음(배터리 세이브, 정책 등)
      wakeLock = null;
    }
  }
  async function releaseWakeLock(){
    try{ await wakeLock?.release(); }catch(_){} finally { wakeLock = null; }
  }
  // 화면이 숨겼다가 다시 보일 때(앱 전환 등) 재요청
  document.addEventListener('visibilitychange', ()=>{
    if (!document.hidden && document.fullscreenElement) requestWakeLock();
  });

  /* 전체화면 토글 */
  const inFullscreen = () => !!document.fullscreenElement;
  function updateFSUI(){
    const fs = inFullscreen();
    fsBtn.textContent = fs ? '전체화면 해제' : '전체화면';
    fsBtn.classList.toggle('hidden', fs); // 전체화면 들어가면 버튼 숨김
    if (fs) requestWakeLock(); else releaseWakeLock();
  }
  fsBtn.addEventListener('click', async ()=>{
    try{
      if(!inFullscreen()){
        await document.documentElement.requestFullscreen();
      }else{
        await document.exitFullscreen();
      }
    }catch(e){}
  });
  document.addEventListener('fullscreenchange', updateFSUI);

  /* 전체화면 종료: 더블 클릭/더블 탭 */
  window.addEventListener('dblclick', async ()=>{
    if(!inFullscreen()) return;
    try{ await document.exitFullscreen(); }catch(_){}
  });
  let lastTapTime = 0;
  const TAP_GAP = 300;
  window.addEventListener('pointerup', async (e)=>{
    // 탭마다 재미로 깜빡
    eyes.forEach(el => {
      el.classList.add('blink');
      setTimeout(() => el.classList.remove('blink'),
        parseFloat(getComputedStyle(root).getPropertyValue('--blink-speed')) + 40);
    });
    if(!inFullscreen()) return;
    const now = e.timeStamp || Date.now();
    if(now - lastTapTime <= TAP_GAP){
      try{ await document.exitFullscreen(); }catch(_){}
      lastTapTime = 0;
    }else{
      lastTapTime = now;
    }
  });
})();
</script>
</body>
</html>
